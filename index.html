<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code è‡ªåŠ¨åŒ–ç«™</title>
    <style>
        :root { --primary-color: #5856d6; --bg-color: #f5f5f7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg-color); color: #333; max-width: 900px; margin: 40px auto; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1 { font-size: 1.5rem; margin-top: 0; display: flex; align-items: center; gap: 10px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        select { cursor: pointer; background-color: white; }
        optgroup { font-weight: bold; }
        textarea { height: 120px; resize: vertical; font-family: inherit; }
        button { background: var(--primary-color); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: opacity 0.2s; width: 100%; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        #log-container { margin-top: 25px; background: #1c1c1e; border-radius: 8px; padding: 15px; position: relative; }
        #log { color: #00ff66; font-family: 'Menlo', 'Monaco', 'Courier New', monospace; font-size: 13px; white-space: pre-wrap; height: 400px; overflow-y: auto; margin: 0; }
        .status-tag { position: absolute; top: 10px; right: 15px; font-size: 11px; color: #888; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ¤– Claude Code è‡ªåŠ¨åŒ–ç«™</h1>
    
    <div class="input-group">
        <label>é¡¹ç›®åç§° (å°†åˆ›å»ºåœ¨ ~/projects/ ç›®å½•ä¸‹)</label>
        <input type="text" id="projectName" placeholder="ä¾‹å¦‚: my-quant-app" value="test-project">
    </div>

    <div class="input-group">
        <label>éœ€æ±‚æè¿°</label>
        <textarea id="prompt" placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘ç”¨ Python å†™ä¸€ä¸ªç®€å•çš„å¸ƒæ—å¸¦ç­–ç•¥ï¼Œè¾“å‡ºåˆ° strategy.py"></textarea>
    </div>

    <div class="input-group">
        <label>é€‰æ‹©å¤§æ¨¡å‹ (OpenRouter çƒ­é—¨æ¨¡å‹)</label>
        <select id="modelSelect">
            <optgroup label="ğŸ”¥ æœ€çƒ­é—¨">
                <option value="anthropic/claude-3.5-sonnet:beta" selected>Claude 3.5 Sonnet (æ¨è)</option>
                <option value="openai/gpt-4-turbo">GPT-4 Turbo</option>
                <option value="openai/gpt-4o">GPT-4o (å¤šæ¨¡æ€)</option>
            </optgroup>
            <optgroup label="âš¡ é«˜æ€§èƒ½">
                <option value="anthropic/claude-3-opus">Claude 3 Opus</option>
                <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option>
                <option value="mistralai/mistral-large">Mistral Large</option>
            </optgroup>
            <optgroup label="ğŸ’° é«˜æ€§ä»·æ¯”">
                <option value="anthropic/claude-3.5-haiku">Claude 3.5 Haiku</option>
                <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
                <option value="google/gemini-flash-1.5">Gemini Flash 1.5</option>
            </optgroup>
        </select>
    </div>

    <button id="runBtn" onclick="runTask()">å¯åŠ¨ AI ç¼–ç¨‹å®¹å™¨</button>

    <div id="log-container">
        <div class="status-tag" id="status">ç­‰å¾…ä¸­...</div>
        <pre id="log">å®¹å™¨è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</pre>
    </div>
</div>

<script>
    async function runTask() {
        const runBtn = document.getElementById('runBtn');
        const logDiv = document.getElementById('log');
        const statusTag = document.getElementById('status');
        const projectName = document.getElementById('projectName').value;
        const prompt = document.getElementById('prompt').value;
        const model = document.getElementById('modelSelect').value;

        if (!projectName || !prompt) {
            alert("è¯·å¡«å…¥é¡¹ç›®åå’Œéœ€æ±‚");
            return;
        }

        // UI çŠ¶æ€æ›´æ–°
        runBtn.disabled = true;
        runBtn.innerText = "æ‰§è¡Œä¸­ï¼Œè¯·ä¸è¦åˆ·æ–°é¡µé¢...";
        logDiv.innerText = "æ­£åœ¨åˆ›å»º Docker å®¹å™¨å¹¶è¿æ¥ OpenRouter (" + model + ")...\nè¿™å¯èƒ½éœ€è¦ 30-60 ç§’ï¼Œå–å†³äºä»»åŠ¡å¤æ‚åº¦ã€‚";
        statusTag.innerText = "RUNNING";

        try {
            const response = await fetch('/run-claude', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    project_name: projectName,
                    prompt: prompt,
                    model: model
                })
            });
            const data = await response.json();
            
            logDiv.innerText = data.log || "æ‰§è¡Œå®Œæˆï¼Œä½†æ²¡æœ‰è¿”å›æ—¥å¿—ã€‚";
            statusTag.innerText = data.status === "success" ? "COMPLETED" : "ERROR";
        } catch (err) {
            logDiv.innerText = "å‘ç”Ÿé”™è¯¯: " + err.message;
            statusTag.innerText = "FAILED";
        } finally {
            runBtn.disabled = false;
            runBtn.innerText = "å¼€å§‹æ‰§è¡Œ";
        }
    }
</script>

</body>
</html>
